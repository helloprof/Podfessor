<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podfessor App</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script> -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">


    <script src="https://kit.fontawesome.com/efeb3f9255.js" crossorigin="anonymous"></script>

</head>

<body>

    <nav class="navbar">
        <!-- FROGGY 1: home button/logo -->
        <a href="/">Home</a>
        <!-- FROGGY 2: search bar -->
        <div>
            <form id="search-form">
                <input id="search-input" type="text" placeholder="Search courses..." />
                <button class="search-button"><i class="fa-solid fa-magnifying-glass"></i></button>
            </form>
            <script>
                let searchForm = document.querySelector("#search-form")
                searchForm.addEventListener("submit", () => {
                    event.preventDefault()
                    let searchInput = searchForm.querySelector("#search-input")
                    let query = searchInput.value.toLowerCase()
                    // console.log("Searching for:", query)

                    // let courseCards = document.querySelectorAll(".course-card")
                    let newCourseCard = document.createElement("div")
                    newCourseCard.classList.add("card")
                    // newCourseCard.innerHTML = `<h3>Search Results for "${query}"</h3>`


                    // // img
                    // let newCardImg = document.createElement("img")
                    // newCardImg.src = course.image

                    // // h4 title
                    let newCardTitle = document.createElement("h4")
                    newCardTitle.textContent = query

                    // // button
                    // let newCardButton = document.createElement("button")
                    // // newCardButton.onclick = () => {
                    // //     open(course.outlineURL, "_blank", "noopener,noreferrer")
                    // // }
                    // newCardButton.className = "button"
                    // newCardButton.textContent = course.code  

                    // // text / paragraph
                    // let newCardP = document.createElement("p")
                    // newCardP.textContent = course.topics.join(", ")

                    // // append children to card
                    // newCard.appendChild(newCardImg)
                    // newCard.appendChild(newCardTitle)
                    // newCard.appendChild(newCardButton)
                    // newCard.appendChild(newCardP)

                    newCourseCard.appendChild(newCardTitle)



                    let cardsContainer = document.querySelector("#cardsContainer")
                    // cardsContainer.innerHTML = "" // Clear previous results
                    cardsContainer.appendChild(newCourseCard)
                })
            </script>

        </div>
        <!-- FROGGY 3: login/menu -->
        <div class="login-menu">
            <a href="/about">About Us</a>
            <a href="/signup">Sign Up</a>
            <a href="/login"> <button class="login-button">LOGIN <i class="fa-solid fa-user"></i></button></a>
        </div>
    </nav>
    <h1 style="font-family: Press Start 2P;">PodFessor App</h1>
    <h2>AI-powered Text-to-Speech Course Summaries </h2>
    <main>
        <!-- OPEN AI CHAT SECTION -->
        <div id="chat" class="section" style="width: 20%;">
            <h5>Create Podcast Script Here!</h5>
            <div style="display: none;" class="loader"></div>
            <!-- <input type="text" placeholder="Ask me anything about your courses..." /> -->

            <form id="chat-form" action="http://httpbin.org/post" method="post">
                <input id="chatInput" style="width: 120px;" type="text" name="chatInput"
                    placeholder="Ask me about your course!" />
                <button type="submit" class="search-button"><i class="fa-solid fa-paper-plane"></i></button>
            </form>
            <audio style="filter: blur(1px);" id="player" controls></audio>
            <script>
                let chatForm = document.querySelector("#chat-form")
                chatForm.addEventListener("submit", () => {
                    event.preventDefault()
                    let chatInput = document.querySelector("#chatInput")
                    let prompt = chatInput.value

                    let loader = document.querySelector(".loader")
                    loader.style.display = "block"
                    let chatblur = document.querySelector("#chat-form")
                    chatblur.style.filter = "blur(2px)"
                    chatInput.disabled = true
                    let searchButton = chatForm.querySelector(".search-button")
                    searchButton.disabled = true


                    // write this as a function to be called by the card buttons  later

                    fetch('https://api.openai.com/v1/responses', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer OPEN-AI-TOKEN-HERE',
                            
                        },
                        body: JSON.stringify({
                            // data
                            "model": "gpt-5",
                            "input": "generate a podcast script and make sure it is short and sweet, fun and not too much info the key is to be more of a show (only one person speaking, no need to put their names as this output will be passed to a text to speech model, keep it under 500 tokens or a few short paragraphs), they will be teaching" + prompt
                            // for images:
                            // "model": "dall-e-3",
                            // "prompt": "generate an image of" +prompt
                        })
                    }).then(response => response.json())
                        .then(data => {
                            let output = data.output[1].content[0].text
                            console.log("OUTPUT:", output)

                            let chatDiv = document.querySelector("#chat")


                            // for images:
                            // let chatResponse = document.createElement("img")
                            // chatResponse.src = data.data[0].url

                            // for displaying the output text:
                            // let chatResponse = document.createElement("p")
                            // chatResponse.textContent = output

                            // chatDiv.appendChild(chatResponse)

                            // now do text to speech
                            // fetch()
                            fetch('https://api.openai.com/v1/audio/speech', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer OPEN-AI-TOKEN-HERE',
                                    
                                },
                                body: JSON.stringify({
                                    // data
                                    "model": "gpt-4o-mini-tts",
                                    "input": output,
                                    "voice": "coral",
                                    "instructions": "Speak in a podcast voice.",

                                    // for images:
                                    // "model": "dall-e-3",
                                    // "prompt": "generate an image of" +prompt
                                })
                            }).then(response => response.blob())
                            .then((audioBlob) => {
                                loader.style.display = "none"
                                chatblur.style.filter = "blur(0px)"
                                chatblur.style.transition = "filter 0.3s ease-in-out"
                                chatInput.disabled = false
                                searchButton.disabled = false
                                // console.log(data)

                                const audioUrl = URL.createObjectURL(audioBlob); // <-- browser-safe URL

                                // You can now use it for an <audio> tag:
                                const audioElement = document.getElementById("player");
                                audioElement.src = audioUrl;

                                console.log("Audio URL:", audioUrl); // in case you want to inspect it
                                audioElement.style.filter = "blur(0px)"
                                audioElement.style.transition = "filter 0.3s ease-in-out"
                            })
                            
                        })
                        .catch(error => {

                            // alert
                            alert("SUBMISSION ERROR: " + error.message)
                        });
                })



            </script>

        </div>

        <!-- <div class="card">
        <iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/playlist/1IHqQ0mqdfKUDigOF2Xegj?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>

    </div> -->
        <!-- <button id="generateButton">GENERATE COURSE CARDS <i class="fa-solid fa-book-open"></i></button> -->

        <!-- CARDS SECTION -->
        <div class="section" style="width: 80%;">
            <div id="semesterContainer"></div>
            <div id="cardsContainer"></div>
        </div>

    </main>
    <form id="subscribe" action="http://httpbin.org/post" method="post">
        <input name="email" type="email" placeholder="subscribe here!" />
        <button type="submit" class="search-button"><i class="fa-solid fa-paper-plane"></i></button>
    </form>
</body>

<script src="js/courses.js"></script>
<script src="js/courseNotes.js"></script>
<script src="js/semesters.js"></script>
<script src="js/app.js"></script>

</html>